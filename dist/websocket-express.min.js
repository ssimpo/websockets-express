function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e)return null;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(o,e){"use strict";var t,a=o.buffer,n=!1,r=new Set,s="main",i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(""),u=new Map,c=new Map,f=new Map,l=new Map,p=new Map,d=new Map,v=new Map,y=Object.freeze({CONNECTING:1,RECONNECTING:2,CLOSED:3,CONNECTED:4}),h=function(e){function u(e){var t,n;_classCallCheck(this,u);for(var r=arguments.length,o=new Array(1<r?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return(n=_possibleConstructorReturn(this,(t=_getPrototypeOf(u)).call.apply(t,[this,e.message].concat(o)))).status=e.status,n}return _inherits(u,_wrapNativeSuper(Error)),u}();function g(){o.document.addEventListener("DOMContentLoaded",w),e&&(e.websocket=new k),o.angular&&o.angular.module("websocket-express",[]).factory("$websocket",function(){return new k}),e||o.angular||(o.bolt?o.bolt.WebSocketService=k:o.BoltWebSocketService=k)}function w(){!function(){!function(){var e,t=o.location.origin,n=o.document.querySelector("base[href]");if(n){var r=(n.getAttribute("href")||"").trim().replace(t,"");""!==r&&(e=t+r)}else e=t+"/";e=e.replace("https://","wss://").replace("http://","ws://"),u.set(s,e)}();var e=o.document.querySelectorAll("link[rel=websocket-endpoint][href]");if(e.length)for(var t=0;t<e.length;t++){var n=(e[t].getAttribute("href")||"").trim();if(""!==n){var r=(e[t].getAttribute("title")||"").trim();""===r&&(r=s),u.set(r,n)}}}(),n=!0,r.forEach(function(e){return e()}),r.clear(),o.document.removeEventListener("DOMContentLoaded",g)}function b(t,n,e){var r=!0;return e.forEach(function(e){r=r&&t!==n[e]}),r}function E(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:32;return new Array(e).fill(0).map(function(){return i[function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*e)+t}(i.length-1)]}).join("")}function C(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s;if(p.has(e)){var t=p.get(e);return t.readyState===t.OPEN?t:void 0}}function N(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;return c.has(t)||c.set(t,new Map),c.get(t).has(e)||c.get(t).set(e,new Set),c.get(t).get(e)}function m(e,t){e.forEach(function(e){return e.delete(t)})}function O(n,r,o){function i(){v.set(o,y.CONNECTED),console.log("Opened ".concat(r," for ").concat(o)),n.addEventListener("close",t),n.addEventListener("message",u),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s,t=l.get(e),n=C(e);t&&n&&(t.forEach(function(e){return n.send(e())}),t.clear(),l.delete(e))}(o)}function t(){var e,t;v.set(o,y.CLOSED),console.log("Closed ".concat(r," for ").concat(o)),n.removeEventListener("open",i),n.removeEventListener("close",u),n.removeEventListener("message",u),e=r,t=o,p.delete(t),setTimeout(function(){b(v.get(t),y,["CONNECTING","RECONNECTING","CONNECTED"])&&(v.set(t,y.RECONNECTING),console.log("Trying reconnect"),p.set(t,new WebSocket(e)),O(p.get(t),e,t))},3e3)}function u(e){var t=function(t){if(t.id){if(f.has(t.id)){var e=f.get(t.id);"error"===t.type?e(t.data,null):e(null,t.data),f.delete(t.id)}}else c.has(t.type)&&c.get(type).forEach(function(e){return callback(t.data)})};if("string"==typeof e.data)t(JSON.parse(e.data));else if(e.data instanceof Blob){var n=new FileReader;n.onload=function(){t(new a.Buffer(new Uint8Array(this.result)))},n.readAsArrayBuffer(e.data)}}n.addEventListener("error",function(e){return console.error("Error on ".concat(r," for ").concat(o),e),t()}),n.addEventListener("open",i)}function _(e,t){e=function(e,t){if(e&&(n?u.set(t,e):r.add(function(){return u.set(t,e)})),!e&&!u.has(t))throw new URIError("No websocket endpoint for ".concat(t));return!e&&u.has(t)&&(e=u.get(t)),e}(e,t),b(v.get(t),y,["CONNECTING","RECONNECTING","CONNECTED"])&&(v.set(t,y.CONNECTING),p.has(t)||p.set(t,new WebSocket(e)),O(p.get(t),e,t))}function S(e){try{return JSON.stringify(e)}catch(e){throw new TypeError("Could not convert data to json for sending")}}var k=function(){function e(){return _classCallCheck(this,e),t||(t=this),this.addParser("json",S),t}return _createClass(e,[{key:"connect",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;if(!e&&!n)return r.add(function(){return _(e,t)});_(e,t)}},{key:"drop",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s;e=t,p.get(e).close()}},{key:"listen",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:s;return N(t,n).add(e),function(){return N(t,n).delete(e)}}},{key:"removeListener",value:function(t,e){if(e&&c.has(e))return m(c.get(e),t);c.forEach(function(e){return m(e,t)})}},{key:"request",value:function(u){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"json";return u.method=u.method||"get",new Promise(function(e,t){var o,i,n=E();f.set(n,(o=e,i=t,function(e,t){if(e)return i(e);if(400<=(t.status||200)){if(e)return i(e);var n=(t.body||t.statusMessage||"").trim(),r=t.status||400;return i(new h({message:n,status:r}))}return o(t)}));var r={type:"request",id:n,data:u};!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,n=C(t);if(n)return n.send(e());l.has(t)||l.set(t,new Set),l.get(t).add(e)}(function(){if(d.has(c))return d.get(c)(r);throw new TypeError("No parser for type ".concat(c))},a)})}},{key:"requestJson",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;return this.request(e,t,"json")}},{key:"ready",value:function(){return!!C(0<arguments.length&&void 0!==arguments[0]?arguments[0]:s)}},{key:"addEndpoint",value:function(e,t){return u.set(e,t),this}},{key:"removeEndpoint",value:function(e){return u.delete(e),this}},{key:"addParser",value:function(e,t){return d.set(e,t),this}},{key:"removeParser",value:function(e){return d.delete(e),this}},{key:"defaultSocketId",get:function(){return s}},{key:Symbol.toStringTag,get:function(){return"WebSocketService"}}]),e}();g()}(window,window.jQuery);
//# sourceMappingURL=websocket-express.min.js.map
