function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e)return null;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(u){"use strict";var t,a=u.buffer,n=!1,r=new Set,s="main",o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(""),i=new Map,c=new Map,f=new Map,l=new Map,d=new Map,p=new Map,v=new Map,y=Object.freeze({CONNECTING:1,RECONNECTING:2,CLOSED:3,CONNECTED:4}),h=function(e){function u(e){var t,n;_classCallCheck(this,u);for(var r=arguments.length,o=new Array(1<r?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return(n=_possibleConstructorReturn(this,(t=_getPrototypeOf(u)).call.apply(t,[this,e.message].concat(o)))).status=e.status,n}return _inherits(u,_wrapNativeSuper(Error)),u}();function g(){!function(){!function(){var e,t=[u.location.origin,u.document.querySelector("base[href]")],n=t[0],r=t[1];if(r){var o=(r.getAttribute("href")||"").trim().replace(n,"");""!==o&&(e="".concat(n).concat(o))}else e="".concat(n,"/");e=e.replace("https://","wss://").replace("http://","ws://"),i.set(s,e)}();var e=u.document.querySelectorAll("link[rel=websocket-endpoint][href]");if(e.length)for(var t=0;t<e.length;t++){var n=(e[t].getAttribute("href")||"").trim();if(""!==n){var r=(e[t].getAttribute("title")||"").trim();""===r&&(r=s),i.set(r,n)}}}(),n=!0,r.forEach(function(e){return e()}),r.clear()}function E(t,n,e){var r=!0;return e.forEach(function(e){r=r&&t!==n[e]}),r}function w(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:32;return new Array(e).fill(0).map(function(){return o[function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*e)+t}(o.length-1)]}).join("")}function b(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s;if(d.has(e)){var t=d.get(e);return t.readyState===t.OPEN?t:void 0}}function m(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;return c.has(t)||c.set(t,new Map),c.get(t).has(e)||c.get(t).set(e,new Set),c.get(t).get(e)}function O(e,t){e.forEach(function(e){return e.delete(t)})}function C(n,r,o){function i(){v.set(o,y.CONNECTED),S.DEBUG&&console.log("Opened ".concat(r," for ").concat(o)),n.addEventListener("close",t),n.addEventListener("message",u),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s,t=l.get(e),n=b(e);t&&n&&(t.forEach(function(e){return n.send(e())}),t.clear(),l.delete(e))}(o)}function t(){var e,t;v.set(o,y.CLOSED),S.DEBUG&&console.log("Closed ".concat(r," for ").concat(o)),n.removeEventListener("open",i),n.removeEventListener("close",u),n.removeEventListener("message",u),e=r,t=o,d.delete(t),setTimeout(function(){E(v.get(t),y,["CONNECTING","RECONNECTING","CONNECTED"])&&(v.set(t,y.RECONNECTING),S.DEBUG&&console.log("Trying reconnect"),d.set(t,new WebSocket(e)),C(d.get(t),e,t))},3e3)}function u(e){var t=function(t){if(t.id){if(f.has(t.id)){var e=f.get(t.id);"error"===t.type?e(t.data,null):e(null,t.data),f.delete(t.id)}}else c.has(t.type)&&c.get(type).forEach(function(e){return callback(t.data)})};if("string"==typeof e.data)t(JSON.parse(e.data));else if(e.data instanceof Blob){var n=new FileReader;n.onload=function(){t(new a.Buffer(new Uint8Array(this.result)))},n.readAsArrayBuffer(e.data)}}n.addEventListener("error",function(e){return console.error("Error on ".concat(r," for ").concat(o),e),t()}),n.addEventListener("open",i)}function N(e,t){e=function(e,t){if(e&&(n?i.set(t,e):r.add(function(){return i.set(t,e)})),!e&&!i.has(t))throw new URIError("No websocket endpoint for ".concat(t));return!e&&i.has(t)&&(e=i.get(t)),e}(e,t),E(v.get(t),y,["CONNECTING","RECONNECTING","CONNECTED"])&&(v.set(t,y.CONNECTING),d.has(t)||d.set(t,new WebSocket(e)),C(d.get(t),e,t))}function _(e){try{return JSON.stringify(e)}catch(e){throw new TypeError("Could not convert data to json for sending")}}var S=function(){function e(){return _classCallCheck(this,e),t||(t=this),this.addParser("json",_),t}return _createClass(e,[{key:"connect",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;if(!e&&!n)return r.add(function(){return N(e,t)});N(e,t)}},{key:"drop",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s;e=t,d.get(e).close()}},{key:"listen",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:s;return m(t,n).add(e),function(){return m(t,n).delete(e)}}},{key:"removeListener",value:function(t,e){if(e&&c.has(e))return O(c.get(e),t);c.forEach(function(e){return O(e,t)})}},{key:"request",value:function(u){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"json";return u.method=u.method||"get",new Promise(function(e,t){var o,i,n=w();f.set(n,(o=e,i=t,function(e,t){if(e)return i(e);if(400<=(t.status||200)){if(e)return i(e);var n=(t.body||t.statusMessage||"").trim(),r=t.status||400;return i(new h({message:n,status:r}))}return o(t)}));var r={type:"request",id:n,data:u};!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,n=b(t);if(n)return n.send(e());l.has(t)||l.set(t,new Set),l.get(t).add(e)}(function(){if(p.has(c))return p.get(c)(r);throw new TypeError("No parser for type ".concat(c))},a)})}},{key:"requestJson",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;return this.request(e,t,"json")}},{key:"ready",value:function(){return!!b(0<arguments.length&&void 0!==arguments[0]?arguments[0]:s)}},{key:"addEndpoint",value:function(e,t){return i.set(e,t),this}},{key:"removeEndpoint",value:function(e){return i.delete(e),this}},{key:"addParser",value:function(e,t){return p.set(e,t),this}},{key:"removeParser",value:function(e){return p.delete(e),this}},{key:"defaultSocketId",get:function(){return s}},{key:Symbol.toStringTag,get:function(){return"WebSocketService"}}]),e}();S.DEBUG=!1,function(){var e=u.jQuery,t=void 0===e?u.$&&u.$.jQuery?u.$:void 0:e,n=u.angular,r=u.bolt,o=u.document;function i(){document.removeEventListener("DOMContentLoaded",i),window.removeEventListener("load",i),g()}t&&(u.jQuery.websocket=new S),n&&n.module("websocket-express",[]).factory("$websocket",function(){return new S}),r&&(r.WebSocketService=S,r.MODE&&(r.MODE.has("DEVELOPMENT")||r.MODE.has("DEBUG"))&&(r.WebSocketService.DEBUG=!0)),r&&t&&n&&(u.BoltWebSocketService=S),"complete"===o.readyState||"loading"!==o.readyState&&!o.documentElement.doScroll?window.setTimeout(g):(document.addEventListener("DOMContentLoaded",i),window.addEventListener("load",i))}()}(window);
//# sourceMappingURL=websocket-express.min.js.map
