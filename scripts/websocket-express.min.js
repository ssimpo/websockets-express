function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(o,e){"use strict";var t,u=o.buffer,n=!1,r=new Set,s="main",a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(""),i=new Map,c=new Map,f=new Map,l=new Map,d=new Map,v=new Map,h=new Map,g=Object.freeze({CONNECTING:1,RECONNECTING:2,CLOSED:3,CONNECTED:4});function E(){o.document.addEventListener("DOMContentLoaded",p),e&&(e.websocket=new S),o.angular&&o.angular.module("websocket-express",[]).factory("$websocket",function(){return new S}),e||o.angular||(o.bolt?o.bolt.WebSocketService=S:o.BoltWebSocketService=S)}function p(){!function(){!function(){var e,t=o.location.origin,n=o.document.querySelector("base[href]");if(n){var r=(n.getAttribute("href")||"").trim().replace(t,"");""!==r&&(e=t+r)}else e=t+"/";e=e.replace("https://","wss://").replace("http://","ws://"),i.set(s,e)}();var e=o.document.querySelectorAll("link[rel=websocket-endpoint][href]");if(e.length)for(var t=0;t<e.length;t++){var n=(e[t].getAttribute("href")||"").trim();if(""!==n){var r=(e[t].getAttribute("title")||"").trim();""===r&&(r=s),i.set(r,n)}}}(),n=!0,r.forEach(function(e){return e()}),r.clear(),o.document.removeEventListener("DOMContentLoaded",E)}function w(t,n,e){var r=!0;return e.forEach(function(e){r=r&&t!==n[e]}),r}function y(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:32;return new Array(e).fill(0).map(function(){return a[function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*e)+t}(a.length-1)]}).join("")}function C(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s;if(d.has(e)){var t=d.get(e);return t.readyState===t.OPEN?t:void 0}}function N(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;return c.has(t)||c.set(t,new Map),c.get(t).has(e)||c.get(t).set(e,new Set),c.get(t).get(e)}function k(e,t){e.forEach(function(e){return e.delete(t)})}function m(n,r,o){function a(){h.set(o,g.CONNECTED),console.log("Opened ".concat(r," for ").concat(o)),n.addEventListener("close",t),n.addEventListener("message",i),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s,t=l.get(e),n=C(e);t&&n&&(t.forEach(function(e){return n.send(e())}),t.clear(),l.delete(e))}(o)}function t(){var e,t;h.set(o,g.CLOSED),console.log("Closed ".concat(r," for ").concat(o)),n.removeEventListener("open",a),n.removeEventListener("close",i),n.removeEventListener("message",i),e=r,t=o,d.delete(t),setTimeout(function(){w(h.get(t),g,["CONNECTING","RECONNECTING","CONNECTED"])&&(h.set(t,g.RECONNECTING),console.log("Trying reconnect"),d.set(t,new WebSocket(e)),m(d.get(t),e,t))},3e3)}function i(e){var t=function(t){if(t.id){if(f.has(t.id)){var e=f.get(t.id);"error"===t.type?e(t.data,null):e(null,t.data),f.delete(t.id)}}else c.has(t.type)&&c.get(type).forEach(function(e){return callback(t.data)})};if("string"==typeof e.data)t(JSON.parse(e.data));else if(e.data instanceof Blob){var n=new FileReader;n.onload=function(){t(new u.Buffer(new Uint8Array(this.result)))},n.readAsArrayBuffer(e.data)}}n.addEventListener("error",function(e){return console.error("Error on ".concat(r," for ").concat(o),e),t()}),n.addEventListener("open",a)}function b(e,t){e=function(e,t){if(e&&(n?i.set(t,e):r.add(function(){return i.set(t,e)})),!e&&!i.has(t))throw new URIError("No websocket endpoint for ".concat(t));return!e&&i.has(t)&&(e=i.get(t)),e}(e,t),w(h.get(t),g,["CONNECTING","RECONNECTING","CONNECTED"])&&(h.set(t,g.CONNECTING),d.has(t)||d.set(t,new WebSocket(e)),m(d.get(t),e,t))}function O(e){try{return JSON.stringify(e)}catch(e){throw new TypeError("Could not convert data to json for sending")}}var S=function(){function e(){return _classCallCheck(this,e),t||(t=this),this.addParser("json",O),t}return _createClass(e,[{key:"connect",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;if(!e&&!n)return r.add(function(){return b(e,t)});b(e,t)}},{key:"drop",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s;e=t,d.get(e).close()}},{key:"listen",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:s;return N(t,n).add(e),function(){return N(t,n).delete(e)}}},{key:"removeListener",value:function(t,e){if(e&&c.has(e))return k(c.get(e),t);c.forEach(function(e){return k(e,t)})}},{key:"request",value:function(i){var u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"json";return i.method=i.method||"get",new Promise(function(e,t){var r,o,n=y();f.set(n,(r=e,o=t,function(e,t){if(e)return o(e);if(400<=(t.status||200)){if(e)return o(e);var n=(t.statusMessage||"").trim();return o(n)}return r(t)}));var a={type:"request",id:n,data:i};!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,n=C(t);if(n)return n.send(e());l.has(t)||l.set(t,new Set),l.get(t).add(e)}(function(){if(v.has(c))return v.get(c)(a);throw new TypeError("No parser for type ".concat(c))},u)})}},{key:"requestJson",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s;return this.request(e,t,"json")}},{key:"ready",value:function(){return!!C(0<arguments.length&&void 0!==arguments[0]?arguments[0]:s)}},{key:"addEndpoint",value:function(e,t){return i.set(e,t),this}},{key:"removeEndpoint",value:function(e){return i.delete(e),this}},{key:"addParser",value:function(e,t){return v.set(e,t),this}},{key:"removeParser",value:function(e){return v.delete(e),this}},{key:"defaultSocketId",get:function(){return s}},{key:Symbol.toStringTag,get:function(){return"WebSocketService"}}]),e}();E()}(window,window.jQuery);
//# sourceMappingURL=websocket-express.min.js.map
