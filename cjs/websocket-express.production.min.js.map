{"version":3,"sources":["src/expressWebsocket.js","node_modules/lodash-es/_arrayPush.js","node_modules/lodash-es/_freeGlobal.js","node_modules/lodash-es/_root.js","node_modules/lodash-es/_Symbol.js","node_modules/lodash-es/_getRawTag.js","node_modules/lodash-es/_objectToString.js","node_modules/lodash-es/_baseGetTag.js","node_modules/lodash-es/isObjectLike.js","node_modules/lodash-es/_baseIsArguments.js","node_modules/lodash-es/isArguments.js","node_modules/lodash-es/isArray.js","node_modules/lodash-es/_isFlattenable.js","node_modules/lodash-es/_baseFlatten.js","node_modules/lodash-es/flatten.js","node_modules/lodash-es/isObject.js","node_modules/lodash-es/isFunction.js","node_modules/lodash-es/_coreJsData.js","node_modules/lodash-es/_isMasked.js","node_modules/lodash-es/_toSource.js","node_modules/lodash-es/_baseIsNative.js","node_modules/lodash-es/_getValue.js","node_modules/lodash-es/_getNative.js","node_modules/lodash-es/_nativeCreate.js","node_modules/lodash-es/_hashClear.js","node_modules/lodash-es/_hashDelete.js","node_modules/lodash-es/_hashGet.js","node_modules/lodash-es/_hashHas.js","node_modules/lodash-es/_hashSet.js","node_modules/lodash-es/_Hash.js","node_modules/lodash-es/_listCacheClear.js","node_modules/lodash-es/eq.js","node_modules/lodash-es/_assocIndexOf.js","node_modules/lodash-es/_listCacheDelete.js","node_modules/lodash-es/_listCacheGet.js","node_modules/lodash-es/_listCacheHas.js","node_modules/lodash-es/_listCacheSet.js","node_modules/lodash-es/_ListCache.js","node_modules/lodash-es/_Map.js","node_modules/lodash-es/_mapCacheClear.js","node_modules/lodash-es/_isKeyable.js","node_modules/lodash-es/_getMapData.js","node_modules/lodash-es/_mapCacheDelete.js","node_modules/lodash-es/_mapCacheGet.js","node_modules/lodash-es/_mapCacheHas.js","node_modules/lodash-es/_mapCacheSet.js","node_modules/lodash-es/_MapCache.js","node_modules/lodash-es/_setCacheAdd.js","node_modules/lodash-es/_setCacheHas.js","node_modules/lodash-es/_SetCache.js","node_modules/lodash-es/_baseFindIndex.js","node_modules/lodash-es/_baseIsNaN.js","node_modules/lodash-es/_strictIndexOf.js","node_modules/lodash-es/_baseIndexOf.js","node_modules/lodash-es/_arrayIncludes.js","node_modules/lodash-es/_arrayIncludesWith.js","node_modules/lodash-es/_cacheHas.js","node_modules/lodash-es/_Set.js","node_modules/lodash-es/noop.js","node_modules/lodash-es/_setToArray.js","node_modules/lodash-es/_createSet.js","node_modules/lodash-es/_baseUniq.js","node_modules/lodash-es/uniq.js","node_modules/lodash-es/isString.js","src/util.js","src/requestHeaders.js","src/request.js","src/response.js","src/server.js"],"names":["handleUpgrade","app","wss","arguments","length","undefined","ws","Server","req","socket","upgradeHead","res","http","ServerResponse","assignSocket","head","Buffer","copy","on","destroy","websocket","cb","client","emit","arrayPush","array","values","index","offset","freeGlobal","global","Object","freeSelf","self","root","Function","Symbol","objectProto","prototype","hasOwnProperty","nativeObjectToString","toString","symToStringTag","toStringTag","getRawTag","value","isOwn","call","tag","e","result","objectToString","nullTag","undefinedTag","baseGetTag","isObjectLike","argsTag","baseIsArguments","propertyIsEnumerable","isArguments","isArray","Array","spreadableSymbol","isConcatSpreadable","isFlattenable","baseFlatten","depth","predicate","isStrict","flatten","isObject","type","asyncTag","funcTag","genTag","proxyTag","isFunction","coreJsData","maskSrcKey","uid","exec","keys","IE_PROTO","isMasked","func","funcProto","funcToString","toSource","reRegExpChar","reIsHostCtor","reIsNative","RegExp","replace","baseIsNative","test","getValue","object","key","getNative","nativeCreate","hashClear","this","__data__","size","hashDelete","has","HASH_UNDEFINED","hashGet","data","hashHas","hashSet","Hash","entries","clear","entry","set","listCacheClear","eq","other","assocIndexOf","get","arrayProto","splice","listCacheDelete","pop","listCacheGet","listCacheHas","listCacheSet","push","ListCache","Map","mapCacheClear","hash","map","string","isKeyable","getMapData","mapCacheDelete","mapCacheGet","mapCacheHas","mapCacheSet","MapCache","setCacheAdd","setCacheHas","SetCache","add","baseFindIndex","fromIndex","fromRight","baseIsNaN","strictIndexOf","baseIndexOf","arrayIncludes","arrayIncludesWith","comparator","cacheHas","cache","Set","noop","setToArray","forEach","INFINITY","createSet","LARGE_ARRAY_SIZE","baseUniq","iteratee","includes","isCommon","seen","outer","computed","seenIndex","uniq","stringTag","isString","chars","split","randomInt","end","start","Math","floor","random","randomString","fill","join","getContentLength","message","_isObject","JSON","stringify","err","definePropertyFixed","instance","propertyName","_propertyName","n","defineProperty","configurable","rebinder","takeFrom","bindTo","methods","method","bind","properties","property","makeArray","_toConsumableArray","ignoreHeaders","addHeaders","excludeHeader","header","toLowerCase","rawHeadersFactory","filterNext","headerName","concat","rawHeaders","filter","headers","requestHeadersFactory","_header","toLocaleLowerCase","Proxy","target","receiver","Reflect","getOwnPropertyDescriptor","reqHeaders","ownKeys","unique","originalRequests","WeakMap","originalMessages","rebind","getBody","body","assign","WebsocketRequestAbstract","types","_len","_key","typeis","WebsocketRequest","_EventEmitter","messageId","wsId","path","secure","_assertThisInitialized","_this","EventEmitter","deprecate","depd","clients","messageIdIds","messageRecieveType","createResponseMessage","originalUrl","statusCode","statusMessage","sendMessage","send","headersSent","WebsocketResponseAbstract","field","val","prev","filename","extname","contentDisposition","name","options","fn","encoding","sort","callback","links","status","view","locals","statuses","code","indexOf","mime","lookup","WebsocketResponse","isWebsocket","upgrade","parseMessage","rawData","parse","generateMessageId","shasum","crypto","createHash","update","id","sessionID","digest","handleRequest","_ref","_req","Request","_res","Response","handle","websocketMiddleware","next","getWebsocketClient","find","_parseMessage2","server"],"mappings":"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","file":"websocket-express.production.min.js","sourcesContent":["import http from 'http';\nimport ws from 'ws';\n\nexport function handleUpgrade(app, wss=new ws.Server({noServer:true})) {\n  // https://github.com/websockets/ws/blob/master/lib/WebSocketServer.js#L77\n  return function (req, socket, upgradeHead) {\n    const res = new http.ServerResponse(req);\n    res.assignSocket(socket);\n\n    // avoid hanging onto upgradeHead as this will keep the entire\n    // slab buffer used by node alive\n    const head = new Buffer(upgradeHead.length);\n    upgradeHead.copy(head);\n\n    res.on('finish', ()=>res.socket.destroy());\n\n    res.websocket = cb=>wss.handleUpgrade(req, socket, head, client=>{\n      wss.emit('connection', client);\n      if (cb) cb(client, app);\n    });\n\n    return app(req, res);\n  };\n};\n","/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\nexport default arrayPush;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nexport default baseIsArguments;\n","import baseIsArguments from './_baseIsArguments.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nexport default isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","import Symbol from './_Symbol.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\n\n/** Built-in value references. */\nvar spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined;\n\n/**\n * Checks if `value` is a flattenable `arguments` object or array.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.\n */\nfunction isFlattenable(value) {\n  return isArray(value) || isArguments(value) ||\n    !!(spreadableSymbol && value && value[spreadableSymbol]);\n}\n\nexport default isFlattenable;\n","import arrayPush from './_arrayPush.js';\nimport isFlattenable from './_isFlattenable.js';\n\n/**\n * The base implementation of `_.flatten` with support for restricting flattening.\n *\n * @private\n * @param {Array} array The array to flatten.\n * @param {number} depth The maximum recursion depth.\n * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.\n * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.\n * @param {Array} [result=[]] The initial result value.\n * @returns {Array} Returns the new flattened array.\n */\nfunction baseFlatten(array, depth, predicate, isStrict, result) {\n  var index = -1,\n      length = array.length;\n\n  predicate || (predicate = isFlattenable);\n  result || (result = []);\n\n  while (++index < length) {\n    var value = array[index];\n    if (depth > 0 && predicate(value)) {\n      if (depth > 1) {\n        // Recursively flatten arrays (susceptible to call stack limits).\n        baseFlatten(value, depth - 1, predicate, isStrict, result);\n      } else {\n        arrayPush(result, value);\n      }\n    } else if (!isStrict) {\n      result[result.length] = value;\n    }\n  }\n  return result;\n}\n\nexport default baseFlatten;\n","import baseFlatten from './_baseFlatten.js';\n\n/**\n * Flattens `array` a single level deep.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to flatten.\n * @returns {Array} Returns the new flattened array.\n * @example\n *\n * _.flatten([1, [2, [3, [4]], 5]]);\n * // => [1, 2, [3, [4]], 5]\n */\nfunction flatten(array) {\n  var length = array == null ? 0 : array.length;\n  return length ? baseFlatten(array, 1) : [];\n}\n\nexport default flatten;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\nexport default setCacheAdd;\n","/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\nexport default setCacheHas;\n","import MapCache from './_MapCache.js';\nimport setCacheAdd from './_setCacheAdd.js';\nimport setCacheHas from './_setCacheHas.js';\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values == null ? 0 : values.length;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\nexport default SetCache;\n","/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nexport default baseFindIndex;\n","/**\n * The base implementation of `_.isNaN` without support for number objects.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.\n */\nfunction baseIsNaN(value) {\n  return value !== value;\n}\n\nexport default baseIsNaN;\n","/**\n * A specialized version of `_.indexOf` which performs strict equality\n * comparisons of values, i.e. `===`.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} value The value to search for.\n * @param {number} fromIndex The index to search from.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction strictIndexOf(array, value, fromIndex) {\n  var index = fromIndex - 1,\n      length = array.length;\n\n  while (++index < length) {\n    if (array[index] === value) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nexport default strictIndexOf;\n","import baseFindIndex from './_baseFindIndex.js';\nimport baseIsNaN from './_baseIsNaN.js';\nimport strictIndexOf from './_strictIndexOf.js';\n\n/**\n * The base implementation of `_.indexOf` without `fromIndex` bounds checks.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} value The value to search for.\n * @param {number} fromIndex The index to search from.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseIndexOf(array, value, fromIndex) {\n  return value === value\n    ? strictIndexOf(array, value, fromIndex)\n    : baseFindIndex(array, baseIsNaN, fromIndex);\n}\n\nexport default baseIndexOf;\n","import baseIndexOf from './_baseIndexOf.js';\n\n/**\n * A specialized version of `_.includes` for arrays without support for\n * specifying an index to search from.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludes(array, value) {\n  var length = array == null ? 0 : array.length;\n  return !!length && baseIndexOf(array, value, 0) > -1;\n}\n\nexport default arrayIncludes;\n","/**\n * This function is like `arrayIncludes` except that it accepts a comparator.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @param {Function} comparator The comparator invoked per element.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludesWith(array, value, comparator) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (comparator(value, array[index])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport default arrayIncludesWith;\n","/**\n * Checks if a `cache` value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\nexport default cacheHas;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Set = getNative(root, 'Set');\n\nexport default Set;\n","/**\n * This method returns `undefined`.\n *\n * @static\n * @memberOf _\n * @since 2.3.0\n * @category Util\n * @example\n *\n * _.times(2, _.noop);\n * // => [undefined, undefined]\n */\nfunction noop() {\n  // No operation performed.\n}\n\nexport default noop;\n","/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nexport default setToArray;\n","import Set from './_Set.js';\nimport noop from './noop.js';\nimport setToArray from './_setToArray.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/**\n * Creates a set object of `values`.\n *\n * @private\n * @param {Array} values The values to add to the set.\n * @returns {Object} Returns the new set.\n */\nvar createSet = !(Set && (1 / setToArray(new Set([,-0]))[1]) == INFINITY) ? noop : function(values) {\n  return new Set(values);\n};\n\nexport default createSet;\n","import SetCache from './_SetCache.js';\nimport arrayIncludes from './_arrayIncludes.js';\nimport arrayIncludesWith from './_arrayIncludesWith.js';\nimport cacheHas from './_cacheHas.js';\nimport createSet from './_createSet.js';\nimport setToArray from './_setToArray.js';\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/**\n * The base implementation of `_.uniqBy` without support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new duplicate free array.\n */\nfunction baseUniq(array, iteratee, comparator) {\n  var index = -1,\n      includes = arrayIncludes,\n      length = array.length,\n      isCommon = true,\n      result = [],\n      seen = result;\n\n  if (comparator) {\n    isCommon = false;\n    includes = arrayIncludesWith;\n  }\n  else if (length >= LARGE_ARRAY_SIZE) {\n    var set = iteratee ? null : createSet(array);\n    if (set) {\n      return setToArray(set);\n    }\n    isCommon = false;\n    includes = cacheHas;\n    seen = new SetCache;\n  }\n  else {\n    seen = iteratee ? [] : result;\n  }\n  outer:\n  while (++index < length) {\n    var value = array[index],\n        computed = iteratee ? iteratee(value) : value;\n\n    value = (comparator || value !== 0) ? value : 0;\n    if (isCommon && computed === computed) {\n      var seenIndex = seen.length;\n      while (seenIndex--) {\n        if (seen[seenIndex] === computed) {\n          continue outer;\n        }\n      }\n      if (iteratee) {\n        seen.push(computed);\n      }\n      result.push(value);\n    }\n    else if (!includes(seen, computed, comparator)) {\n      if (seen !== result) {\n        seen.push(computed);\n      }\n      result.push(value);\n    }\n  }\n  return result;\n}\n\nexport default baseUniq;\n","import baseUniq from './_baseUniq.js';\n\n/**\n * Creates a duplicate-free version of an array, using\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons, in which only the first occurrence of each element\n * is kept. The order of result values is determined by the order they occur\n * in the array.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @returns {Array} Returns the new duplicate free array.\n * @example\n *\n * _.uniq([2, 1, 2]);\n * // => [2, 1]\n */\nfunction uniq(array) {\n  return (array && array.length) ? baseUniq(array) : [];\n}\n\nexport default uniq;\n","import baseGetTag from './_baseGetTag.js';\nimport isArray from './isArray.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar stringTag = '[object String]';\n\n/**\n * Checks if `value` is classified as a `String` primitive or object.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a string, else `false`.\n * @example\n *\n * _.isString('abc');\n * // => true\n *\n * _.isString(1);\n * // => false\n */\nfunction isString(value) {\n  return typeof value == 'string' ||\n    (!isArray(value) && isObjectLike(value) && baseGetTag(value) == stringTag);\n}\n\nexport default isString;\n","import {isObject, isString, isNumber, isBoolean, uniq as unique, flatten} from 'lodash-es';\n\nconst chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz'.split('');\n\n\n/**\n * Generate a random integer between a start end end value.\n *\n * @param {integer} end\t\t\t\tThe start of the range.\n * @param {integer} [start=0]\t\tThe end of the range.\n * @returns {integer}\t\t\t\tRandom generated number.\n */\nexport function randomInt(end, start=0) {\n\treturn Math.floor(Math.random() * end) + start;\n}\n\n/**\n * Generate a randomstring.\n *\n * @param {integer} [length=32]\t\tThe length of string to generate.\n * @returns {string}\t\t\t\tRandom generated string.\n */\nexport function randomString(length=32) {\n\treturn (new Array(length)).fill(0).map(()=>chars[randomInt(chars.length - 1)]).join('');\n}\n\n/**\n * Get the length of a message object. Used to fake the content-length header in socket.io routes.\n *\n * @private\n * @param {*} message     Message to get length of.  This is assumed to be an object.\n * @returns {number}      Message length.\n */\nexport function getContentLength(message) {\n\ttry {\n\t\tif (isObject(message)) return JSON.stringify(message || {}).length.toString();\n\t\treturn message.toString().length.toString();\n\t} catch(err) {}\n\n\treturn \"1\";\n}\n\n/**\n * Define a defineProperty object for non-configurable property.\n *\n * @param {Object} instance\t\t\t\t\t\t\tInstance to do defineProperty on.\n * @param {string|Array.<string>} propertyName\t\tProperty name(s) to do defineProperty on.\n * @param {*} value\t\t\t\t\t\t\t\t\tThe property value to set.\n * @returns {Object}\t\t\t\t\t\t\t\tThe the instance for chaining purposes.\n */\nexport function definePropertyFixed(instance, propertyName, value) {\n\tmakeArray(propertyName).forEach((_propertyName, n)=>Object.defineProperty(instance, _propertyName, {\n\t\tconfigurable: false,\n\t\tenumerable: true,\n\t\tget: ()=>Array.isArray(propertyName)?value[n]:value,\n\t\tset: ()=>false\n\t}));\n\n\treturn instance;\n}\n\n/**\n * Define a defineProperty object for a standard enumerable, read/write property.\n *\n * @param {Object} instance\t\t\t\t\t\t\tInstance to do defineProperty on.\n * @param {string|Array.<string>} propertyName\t\tProperty name(s) to do defineProperty on.\n * @param {*} value\t\t\t\t\t\t\t\t\tThe property value to set.\n * @param {boolean} [configurable=false]\t\t\tIs this going to set the configurable property?\n * @returns {Object}\t\t\t\t\t\t\t\tThe the instance for chaining purposes.\n */\nexport function defineProperty(instance, propertyName, value, configurable=false) {\n\tmakeArray(propertyName).forEach((_propertyName, n)=>Object.defineProperty(instance, _propertyName, {\n\t\tconfigurable,\n\t\tenumerable: true,\n\t\twritable: true,\n\t\tvalue:Array.isArray(propertyName)?value[n]:value\n\t}));\n\n\treturn instance;\n}\n\n/**\n * Bind a given set of methods in one object to another object.\n *\n * @param {Object} takeFrom\t\t\tObject to bind methods in.\n * @param {Object} bindTo\t\t\tObject to bind each method to.\n * @param {Array} methods\t\t\tMethods to bind.\n * @returns {Object}\t\t\t\tThe takeFrom object for chaining.\n */\nexport function rebinder(takeFrom, bindTo, methods) {\n\tmakeArray(methods.methods).forEach(method=>{\n\t\tbindTo[method] = takeFrom[method].bind(bindTo);\n\t});\n\tmakeArray(methods.properties).forEach(property=>Object.defineProperty(bindTo, property, {\n\t\tget: ()=>takeFrom[property],\n\t\tset: value=>{takeFrom[property] = value}\n\t}));\n\n\treturn takeFrom;\n}\n\n/**\n * Turn the given value into an array.  If it is already an array then return it; if it is a set then convert to an\n * array; and if neither then return as the first item in an array. The purpose of this function is for function\n * or method parameters where they can be either a array or not.  You can use this to ensure you are working on\n * an array.\n *\n * @public\n * @param {Array|Set|*} value\t\tValue to return or convert.\n * @returns {Array}\t\t\t\t\tThe converted value (or original if already an array).\n */\nexport function makeArray(value) {\n\tif (value === undefined) return [];\n\tif (value instanceof Set) return [...value];\n\treturn (Array.isArray(value) ? value : [value]);\n}\n\nexport {isObject};\nexport {isString};\nexport {isNumber};\nexport {isBoolean};\nexport {unique};\nexport {flatten};","import {unique, flatten} from './util';\n\nconst ignoreHeaders = ['upgrade', 'sec-websocket-key', 'sec-websocket-version', 'sec-websocket-extensions'];\nconst addHeaders = {\n\tConnection: 'keep-alive'\n};\n\n/**\n * Should a given request header be excluded in the new generated request? Used to remove upgrade style headers from\n * the generated request.\n *\n * @param {string} header\t\tHeader name to test.\n * @returns {boolean}\t\t\tShould it be excluded.\n */\nfunction excludeHeader(header) {\n\treturn (Object.keys(addHeaders).includes(header.toString()) || ignoreHeaders.includes(header.toString().toLowerCase()));\n}\n\n/**\n * Given a request object and a message object, return a rawHeaders property for the request.\n *\n * @param {WebsocketRequest} req\t\tThe request to get rawHeaders on.\n * @param {Object} message\t\t\t\tThe associated websocket message.\n * @returns {Array.<string>}\t\t\tThe rawHeaders array.\n */\nexport function rawHeadersFactory(req, message) {\n\tlet filterNext = false;\n\n\treturn flatten(...Object.keys(addHeaders).map(headerName=>[headerName, addHeaders[headerName]])).concat(\n\t\treq.rawHeaders.map(header=>{\n\t\t\tif (!filterNext && !excludeHeader(header)) return header;\n\t\t\tfilterNext = !filterNext;\n\t\t}).filter(\n\t\t\theader=>header\n\t\t)\n\t).concat(\n\t\tflatten(...Object.keys(message.headers).map(headerName=>[headerName, message.headers[headerName]])).map(header=>{\n\t\t\tif (!filterNext && !excludeHeader(header)) return header;\n\t\t\tfilterNext = !filterNext;\n\t\t}).filter(\n\t\t\theader=>header\n\t\t)\n\t);\n}\n\n/**\n * Factory for generating headers for WebsocketRequest.\n *\n * @param {WebsocketRequest} req\t\tThe request to generate headers on.\n * @param {Object} message\t\t\t\tThe associated websocket message.\n * @returns {Proxy}\t\t\t\t\t\tHeaders object.\n */\nexport function requestHeadersFactory(req, message) {\n\tlet headers = {};\n\n\tObject.keys(req.headers).forEach(_header=>{\n\t\tlet header = _header.toLocaleLowerCase();\n\t\tif (!ignoreHeaders.includes(header)) headers[header] = req.headers[_header];\n\t});\n\tObject.keys(message.headers || {}).forEach(key=>{\n\t\theaders[key.toLocaleLowerCase()] = message.headers[key];\n\t});\n\tObject.keys(addHeaders).forEach(key=>{\n\t\theaders[key.toLocaleLowerCase()] = addHeaders[key];\n\t});\n\n\treturn new Proxy(headers, {\n\t\tget: (target, property, receiver)=>{\n\t\t\treturn Reflect.get(target, property, receiver) ||\n\t\t\t\t((!ignoreHeaders.includes(property)) ? Reflect.get(req.headers, property, receiver) : undefined);\n\t\t},\n\n\t\tset: (target, property, value, receiver)=>{\n\t\t\treturn Reflect.set(target, property, value, receiver);\n\t\t},\n\n\t\thas: (target, property)=>{\n\t\t\treturn Reflect.has(target, property) ||\n\t\t\t\t((!ignoreHeaders.includes(property)) ? Reflect.has(req.headers, property) : undefined);\n\t\t},\n\n\t\tgetOwnPropertyDescriptor(target, property) {\n\t\t\tif (Reflect.has(target, property)) return Reflect.getOwnPropertyDescriptor(target, property);\n\t\t\tif (!ignoreHeaders.includes(property) && Reflect.has(req.headers, property)) {\n\t\t\t\treturn Reflect.getOwnPropertyDescriptor(req.headers, property);\n\t\t\t}\n\t\t},\n\n\t\townKeys(target) {\n\t\t\tlet reqHeaders = Reflect.ownKeys(req.headers).filter(header=>!ignoreHeaders.includes(header));\n\t\t\treturn unique(Reflect.ownKeys(target).concat(reqHeaders));\n\t\t}\n\t});\n}","import {requestHeadersFactory, rawHeadersFactory} from './requestHeaders';\nimport typeis from 'type-is';\nimport {isObject, defineProperty, definePropertyFixed, rebinder} from './util';\nimport EventEmitter from 'events';\n\nconst originalRequests = new WeakMap();\nconst originalMessages = new WeakMap();\n\n\nconst rebind = {\n\tmethods: ['accepts', 'acceptsCharsets', 'acceptsEncodings', 'acceptsLanguages', 'param'],\n\tproperties: ['hostname', 'ip', 'ips', 'subdomains', 'cookies', 'signedCookies', 'sessionID', 'session']\n};\n\n\n/**\n * Get the request body from a message object.\n *\n * @param {Object} message\t\t\tMessage object to get from.\n * @returns {Object}\t\t\t\tThe message body object.\n */\nfunction getBody(message) {\n\treturn isObject(message.body) ? Object.assign({}, message.body) : (message.body || {});\n}\n\n/**\n * Object to mixin to the Request object.\n *\n * @type {Object}\n */\nconst WebsocketRequestAbstract = {\n\t/**\n\t * Get a header value.\n\t *\n\t * @param {string} header\t\tThe header to get.\n\t * @returns {*}\t\t\t\t\tThe header value.\n\t */\n\tget: function(header) {\n\t\treturn this.headers[header];\n\t},\n\n\t/**\n\t * Is the message of a given mime-type?\n\t *\n\t * @param {string|Array.<string>}\t\tMimetype(s) to match.\n\t * @returns {boolean}\t\t\t\t\tDoes the request match one of the given mimetypes?\n\t */\n\tis: function (...types) {\n\t\treturn typeis(this, types);\n\t}\n};\n\nexport class WebsocketRequest extends EventEmitter {\n\tconstructor(req, message, messageId, wsId) {\n\t\tsuper();\n\n\t\tdefineProperty(this, 'body', getBody(message), true);\n\t\tdefineProperty(\n\t\t\tthis,\n\t\t\t['method', 'originalUrl', 'params', 'path', 'query', 'url'],\n\t\t\t[message.method, message.path, {}, message.path, {}, message.path]\n\t\t);\n\n\t\tdefinePropertyFixed(\n\t\t\tthis,\n\t\t\t['app', 'headers', 'messageId', 'protocol', 'rawHeaders', 'secure', 'websocket', 'xhr', '_req', 'websocketId'],\n\t\t\t[\n\t\t\t\treq.app,\n\t\t\t\trequestHeadersFactory(req, message),\n\t\t\t\tmessageId,\n\t\t\t\t(req.secure ? 'wss' : 'ws'),\n\t\t\t\trawHeadersFactory(req, message),\n\t\t\t\treq.secure,\n\t\t\t\ttrue,\n\t\t\t\tfalse,\n\t\t\t\treq,\n\t\t\t\twsId\n\t\t\t]\n\t\t);\n\n\t\trebinder(WebsocketRequestAbstract, this, {methods: Object.keys(WebsocketRequestAbstract)});\n\t\trebinder(req, this, rebind);\n\n\t\toriginalRequests.set(this, req);\n\t\toriginalMessages.set(this, message);\n\t}\n}","import {isObject, defineProperty, rebinder, definePropertyFixed} from './util';\nimport mime from 'mime';\nimport vary from 'vary';\nimport depd from 'depd';\nimport contentDisposition from 'content-disposition';\nimport statuses from 'statuses';\n\nconst deprecate = depd('express');\nconst clients = new WeakMap();\nconst messageIdIds = new WeakMap();\nconst messageRecieveType = new WeakMap();\n\n\n/**\n * Create a new message as a response from given WebsocketResponse and body object.\n *\n * @param {WebsocketResponse} res\t\tResponse instance.\n * @param {Object|*} body\t\t\t\tBody object.\n * @returns {Object}\t\t\t\t\tNew response message.\n */\nfunction createResponseMessage(res, body) {\n\treturn {\n\t\tid: messageIdIds.get(res),\n\t\ttype: 'response',\n\t\tdata: {\n\t\t\tpath: res.req.originalUrl,\n\t\t\tbody,\n\t\t\theaders: res.headers || {},\n\t\t\tstatus: res.statusCode,\n\t\t\tstatusMessage: res.statusMessage || '',\n\t\t\ttype: res.get('Content-Type') || 'application/json'\n\t\t}\n\t};\n}\n\n/**\n * Send a message, using the given response instance and message.\n *\n * @param {WebsocketResponse} res\t\tThe request object.\n * @param {Object} message\t\t\t\tThe message object.\n * @param {WebsocketResponse}\t\t\tFor chaining.\n */\nfunction sendMessage(res, message) {\n\tconst type = messageRecieveType.get(res);\n\tconst client = clients.get(res);\n\tif (client) client.send(JSON.stringify(message));\n\tres.headersSent = true;\n\treturn res;\n}\n/**\n * Mixin for WebsocketResponse instances.\n *\n * @type {Object}\n */\nconst WebsocketResponseAbstract = {\n\t/**\n\t * Append additional header `field` with value `val`.\n\t *\n\t * Example:\n\t *\n\t *    res.append('Link', ['<http://localhost/>', '<http://localhost:3000/>']);\n\t *    res.append('Set-Cookie', 'foo=bar; Path=/; HttpOnly');\n\t *    res.append('Warning', '199 Miscellaneous warning');\n\t *\n\t * @public\n\t * @param {String} field\t\t\tField to set.\n\t * @param {String|Array} val\t\tValue to set.\n\t * @return {WebsocketResponse} \t\tFor chaining.\n\t */\n\tappend: function(field, val) {\n\t\tlet prev = this.get(field);\n\t\tlet value = val;\n\n\t\tif (prev) value = (Array.isArray(prev) ?\n\t\t\t\tprev.concat(val) :\n\t\t\t\t(Array.isArray(val) ? [prev].concat(val) : [prev, val])\n\t\t);\n\n\t\treturn this.set(field, value);\n\t},\n\n\t/**\n\t * Set _Content-Disposition_ header to _attachment_ with optional `filename`.\n\t *\n\t * @public\n\t * @param {String} filename\t\t\tFilename to set it to.\n\t * @return {WebsocketResponse}\t\tFor chaining.\n\t */\n\tattachment: function(filename) {\n\t\tif (filename) this.type(extname(filename));\n\t\tthis.set('Content-Disposition', contentDisposition(filename));\n\t\treturn this;\n\t},\n\n\tcookie: function(name, value, options) {\n\n\t},\n\n\tclearCookie: function(name, options) {\n\n\t},\n\n\tdownload: function(path, filename, fn) {\n\n\t},\n\n\tend: function(data, encoding) {\n\n\t},\n\n\tformat: function(object) {\n\n\t},\n\n\t/**\n\t * Get a specific header value.\n\t *\n\t * @param {string} field\t\tThe header to het.\n\t * @returns {*}\t\t\t\t\tThe header value.\n\t */\n\tget: function(field) {\n\t\treturn this.headers[field];\n\t},\n\n\t/**\n\t * Get a specific header value.\n\t *\n\t * @param {string} field\t\tThe header to het.\n\t * @returns {*}\t\t\t\t\tThe header value.\n\t */\n\tgetHeader: function(field) {\n\t\treturn this.get(field);\n\t},\n\n\t/**\n\t * Get all the header names.\n\t *\n\t * @returns {Array.<string>}\t\tArray of header names.\n\t */\n\tgetHeaderNames: function() {\n\t\treturn Object.keys(this.headers).sort();\n\t},\n\n\t/**\n\t * Get all the headers.\n\t *\n\t * @returns {Object}\t\tThe headers object.\n\t */\n\tgetHeaders: function() {\n\t\treturn this.headers;\n\t},\n\n\t/**\n\t * Test if response has a particular header.\n\t *\n\t * @param {string} header\t\tHeader to test.\n\t * @returns {boolean}\t\t\tDoes it have given header?\n\t */\n\thasHeader: function(header) {\n\t\treturn (header in this.headers);\n\t},\n\n\t/**\n\t * Send JSON response.\n\t *\n\t * Examples:\n\t *\n\t *     res.json(null);\n\t *     res.json({ user: 'tj' });\n\t *\n\t * @public\n\t * @param {string|number|boolean|object} body\t\tBody to send.\n\t * @return {WebsocketResponse} \t\t\t\t\t\tFor chaining.\n\t */\n\tjson: function(body) {\n\t\tthis.type('application/json');\n\t\treturn this.send(body);\n\t},\n\n\t/**\n\t * Send JSON response with JSONP callback support.\n\t *\n\t * Examples:\n\t *\n\t *     res.jsonp(null);\n\t *     res.jsonp({ user: 'tj' });\n\t *\n\t * @public\n\t * @param {string|number|boolean|object} body\t\tBody to send.\n\t * @return {WebsocketResponse} \t\t\t\t\t\tFor chaining\n\t */\n\tjsonp: function(body) {\n\t\tthis.type('application/javascript');\n\t\tlet response = createResponseMessage(this, body);\n\t\tresponse.data.callback = this.app.get('jsonp callback name') || 'callback';\n\t\treturn this.send(body);\n\t},\n\n\tlinks: function(links) {\n\n\t},\n\n\t/**\n\t * Set the location header to `url`.\n\t *\n\t * The given `url` can also be \"back\", which redirects to the _Referrer_ or _Referer_ headers or \"/\".\n\t *\n\t * Examples:\n\t *\n\t *    res.location('/foo/bar').;\n\t *    res.location('http://example.com');\n\t *    res.location('../login');\n\t *\n\t * @public\n\t * @param {String} url\t\t\t\tUrl to set location to.\n\t * @return {WebsocketResponse} \t\tFor chaining\n\t */\n\tlocation: function(path) {\n\t\tthis.set('location', path);\n\t},\n\n\t/**\n\t * Redirect to the given `url` with optional response `status` defaulting to 302.\n\t *\n\t * The resulting `url` is determined by `res.location()`, so it will play nicely with mounted apps, relative paths,\n\t * `\"back\"` etc.\n\t *\n\t * Examples:\n\t *\n\t *    res.redirect('/foo/bar');\n\t *    res.redirect('http://example.com');\n\t *    res.redirect(301, 'http://example.com');\n\t *    res.redirect('../login'); // /blog/post/1 -> /blog/login\n\t *\n\t * @public\n\t * @param {number} [status=302]\t\tStatus to send.\n\t * @param {string} path\t\t\t\tPath to redirect to.\n\t * @return {WebsocketResponse} \t\tFor chaining.\n\t */\n\tredirect: function(status, path) {\n\t\tif (!path) [status, path] = [302, status];\n\t\tthis.status(status);\n\t\tthis.type('plain/text');\n\t\tthis.send(path);\n\t},\n\n\trender: function(view, locals, callback) {\n\n\t},\n\n\t/**\n\t * Send a response.\n\t *\n\t * Examples:\n\t *\n\t *     res.send(Buffer.from('wahoo'));\n\t *     res.send({ some: 'json' });\n\t *     res.send('<p>some html</p>');\n\t *\n\t * @public\n\t * @param {string|number|boolean|object|Buffer} body\t\tMessage body to send.\n\t * @return {WebsocketResponse} \t\t\t\t\t\t\t\tFor chaining.\n\t */\n\tsend: function(body) {\n\t\treturn sendMessage(this, createResponseMessage(this, body));\n\t},\n\n\tsendFile: function(path, options, fn) {\n\n\t},\n\n\t/**\n\t * Send given HTTP status code and message.\n\t *\n\t * Sets the response status to `statusCode` and the body of the response to the standard description from node's\n\t * http.STATUS_CODES or the statusCode number if no description.\n\t *\n\t * Examples:\n\t *\n\t *     res.sendStatus(200);\n\t *\n\t * @public\n\t * @param {number} statusCode\t\t\t\t\t\t\t\t\t\t\t\t\t\tCode to send.\n\t * @param {string} [statusMessage=statuses[statusCode] || this.statusMessage]\t\tMessage to send.\n\t * @return {WebsocketResponse} \t\t\t\t\t\t\t\t\t\t\t\t\t\tFor chaining.\n\t */\n\tsendStatus: function(statusCode, statusMessage=statuses[statusCode] || this.statusMessage) {\n\t\tthis.status(statusCode);\n\t\tthis.type('plain/text');\n\t\tthis.send(statusMessage);\n\t},\n\n\t/**\n\t * Set header `field` to `val`, or parse an object of header fields.\n\t *\n\t * Examples:\n\t *\n\t *    res.set('Foo', ['bar', 'baz']);\n\t *    res.set('Accept', 'application/json');\n\t *    res.set({ Accept: 'text/plain', 'X-API-Key': 'tobi' });\n\t *\n\t * @public\n\t * @param {String|Object} field\t\tHeader to set\n\t * @param {String|Array} val\t\tValue to set header to.\n\t * @return {WebsocketResponse} \t\tFor chaining.\n\t */\n\tset: function(field, value) {\n\t\tconst headers = this.headers;\n\t\tif (isObject(field)) {\n\t\t\tObject.keys(field).forEach(header=>{\n\t\t\t\theaders[header] = field[header];\n\t\t\t});\n\t\t} else {\n\t\t\theaders[field] = value;\n\t\t}\n\t},\n\n\t/**\n\t * Set header `field` to `val`, or parse an object of header fields.\n\t *\n\t * Examples:\n\t *\n\t *    res.set('Foo', ['bar', 'baz']);\n\t *    res.set('Accept', 'application/json');\n\t *    res.set({ Accept: 'text/plain', 'X-API-Key': 'tobi' });\n\t *\n\t * @public\n\t * @param {String|Object} field\t\tHeader to set\n\t * @param {String|Array} val\t\tValue to set header to.\n\t * @return {WebsocketResponse} \t\tFor chaining.\n\t */\n\tsetHeader: function(header, value) {\n\t\treturn this.set(header, value);\n\t},\n\n\t/**\n\t * Set status `code`.\n\t *\n\t * @public\n\t * @param {Number} code\t\t\t\tStatus code.\n\t * @return {WebsocketResponse}\t\tFor chaining.\n\t */\n\tstatus: function(code) {\n\t\tthis.statusCode = code;\n\t\tthis.statusMessage = statuses[code];\n\t\treturn this;\n\t},\n\n\t/**\n\t * Set _Content-Type_ response header with `type` through `mime.lookup()` when it does not contain \"/\", or set the\n\t * Content-Type to `type` otherwise.\n\t *\n\t * Examples:\n\t *\n\t *     res.type('.html');\n\t *     res.type('html');\n\t *     res.type('json');\n\t *     res.type('application/json');\n\t *     res.type('png');\n\t *\n\t * @public\n\t * @param {String} type\t\t\t\tMimetype string.\n\t * @return {WebsocketResponse}\t\tFor chaining.\n\t */\n\ttype: function(type) {\n\t\treturn this.set('Content-Type', ((type.indexOf('/') === -1) ? mime.lookup(type) : type));\n\t},\n\n\t/**\n\t * Add `field` to Vary. If already present in the Vary set, then this call is simply ignored.\n\t *\n\t * @public\n\t * @param {Array|String} field\t\tField to vary.\n\t * @return {WebsocketResponse}\t\tFor chaining.\n\t */\n\tvary: function(field) {\n\t\tif (!field || (Array.isArray(field) && !field.length)) {\n\t\t\tdeprecate('res.vary(): Provide a field name');\n\t\t\treturn this;\n\t\t}\n\t\tvary(this, field);\n\t\treturn this;\n\t}\n};\n\nexport class WebsocketResponse {\n\tconstructor(req, client, messageId, type) {\n\t\tdefineProperty(this, ['headers', 'headersSent', 'statusCode', 'statusMessage'], [{}, false, 200, 'Ok']);\n\t\tdefinePropertyFixed(\n\t\t\tthis,\n\t\t\t['locals', 'req', 'app', 'websocketClient'],\n\t\t\t[{}, req, req.app, client]\n\t\t);\n\n\t\trebinder(WebsocketResponseAbstract, this, {methods: Object.keys(WebsocketResponseAbstract)});\n\n\t\tclients.set(this, client);\n\t\tmessageIdIds.set(this, messageId);\n\t\tmessageRecieveType.set(this, type)\n\t}\n}","import ws from 'ws';\r\nimport {handleUpgrade} from './expressWebsocket';\r\nimport {WebsocketRequest as Request} from './request';\r\nimport {WebsocketResponse as Response} from './response';\r\nimport crypto from 'crypto';\r\nimport {getContentLength, makeArray, randomString, isString} from './util';\r\n\r\n\r\nfunction isWebsocket(req) {\r\n\treturn !(\r\n\t\t!!req.websocket ||\r\n\t\t!req.headers ||\r\n\t\t(req.headers.upgrade === undefined) ||\r\n\t\t(req.headers.upgrade.toLowerCase() !== 'websocket')\r\n\t);\r\n}\r\n\r\nfunction parseMessage(rawData) {\r\n\tif (isString(rawData)) {\r\n\t\ttry {\r\n\t\t\treturn ['json', JSON.parse(rawData)];\r\n\t\t} catch(err) {}\r\n\t}\r\n\treturn ['unknown', undefined];\r\n}\r\n\r\nfunction generateMessageId(message, req) {\r\n\tconst shasum = crypto.createHash('sha1');\r\n\tshasum.update(`${message.id}${req.sessionID}`);\r\n\treturn shasum.digest('hex');\r\n}\r\n\r\nfunction handleRequest({message, app, req, client, messageId, type}) {\r\n\tmessage.data.headers = Object.assign(message.data.headers || {}, {\r\n\t\t'Content-Type': 'application/json',\r\n\t\t'Transfer-Encoding': 'identity',\r\n\t\t'Content-Length': getContentLength(message.data.body)\r\n\t});\r\n\r\n\tconst _req = new Request(req, message.data, messageId, client.id);\r\n\tconst _res = new Response(_req, client, message.id, type);\r\n\r\n\tapp.handle(_req, _res);\r\n}\r\n\r\nexport function websocketMiddleware(req, res, next) {\r\n\tif (!isWebsocket(req)) return next();\r\n\r\n\tres.websocket((client, app)=>{\r\n\t\tclient.id = randomString();\r\n\t\tapp.getWebsocketClient = id=>makeArray((app.wss || {}).clients).find(client=>(client.id === id));\r\n\r\n\t\tclient.on('message', rawData=>{\r\n\t\t\tconst [type, message] = parseMessage(rawData);\r\n\r\n\t\t\tif (!!message && !!message.type) {\r\n\t\t\t\tconst messageId = generateMessageId(message, req);\r\n\t\t\t\tif (message.type === 'request') return handleRequest({message, app, req, client, messageId, type});\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function upgrade(server, app) {\r\n\tconst wss = new ws.Server({noServer:true});\r\n\tserver.on('upgrade', handleUpgrade(app, wss));\r\n\treturn wss;\r\n}"]}