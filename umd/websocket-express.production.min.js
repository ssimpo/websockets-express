!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t,n){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&i(o,n.prototype),o}).apply(null,arguments)}function t(e){var n="function"==typeof Map?new Map:void 0;return(t=function(e){if(null===e)return null;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return r(e,arguments,u(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)})(e)}function f(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var e="object"==typeof global&&global&&global.Object===Object&&global,n="object"==typeof self&&self&&self.Object===Object&&self,a=e||n||Function("return this")(),s=a.Symbol,l=Object.prototype,d=l.hasOwnProperty,v=l.toString,p=s?s.toStringTag:void 0;var y=Object.prototype.toString;var h="[object Null]",w="[object Undefined]",g=s?s.toStringTag:void 0;function b(e){return null==e?void 0===e?w:h:g&&g in Object(e)?function(e){var t=d.call(e,p),n=e[p];try{e[p]=void 0}catch(e){}var r=v.call(e);return t?e[p]=n:delete e[p],r}(e):(t=e,y.call(t));var t}function E(e){return null!=e&&"object"==typeof e}function O(e){return E(e)&&"[object Arguments]"==b(e)}var m=Object.prototype,S=m.hasOwnProperty,j=m.propertyIsEnumerable;O(function(){return arguments}()),s&&s.isConcatSpreadable;function N(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var C="[object AsyncFunction]",k="[object Function]",T="[object GeneratorFunction]",D="[object Proxy]";var M,L=a["__core-js_shared__"],G=(M=/[^.]+$/.exec(L&&L.keys&&L.keys.IE_PROTO||""))?"Symbol(src)_1."+M:"";var P=Function.prototype.toString;var z=/^\[object .+?Constructor\]$/,R=Function.prototype,_=Object.prototype,A=R.toString,B=_.hasOwnProperty,I=RegExp("^"+A.call(B).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function U(e){return!(!N(e)||(t=e,G&&G in t))&&(function(e){if(!N(e))return!1;var t=b(e);return t==k||t==T||t==C||t==D}(e)?I:z).test(function(e){if(null!=e){try{return P.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function $(e,t){var n,r,o=(r=t,null==(n=e)?void 0:n[r]);return U(o)?o:void 0}$(Object,"create"),$(a,"Map");var q=$(a,"Set");q&&(x=new q([,-0]),F=-1,W=Array(x.size),x.forEach(function(e){W[++F]=e}),W)[1];var x,F,W,J="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");function Q(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:32;return new Array(e).fill(0).map(function(){return J[function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*e)+t}(J.length-1)]}).join("")}var V,H,K=window.buffer,X=!1,Z=new Set,Y="main",ee=new Map,te=new Map,ne=new Map,re=new Map,oe=new Map,ie=new Map,ae=new Map,ce=new Map,ue=Object.freeze({CONNECTING:1,RECONNECTING:2,CLOSED:3,CONNECTED:4}),fe=function(e){function a(e){var t,n;c(this,a);for(var r=arguments.length,o=new Array(1<r?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return(n=f(this,(t=u(a)).call.apply(t,[this,e.message].concat(o)))).status=e.status,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(a,t(Error)),a}();function se(){!function(){!function(){var e,t=[window.location.origin,window.document.querySelector("base[href]")],n=t[0],r=t[1];if(r){var o=(r.getAttribute("href")||"").trim().replace(n,"");""!==o&&(e="".concat(n).concat(o))}else e="".concat(n,"/");e=e.replace("https://","wss://").replace("http://","ws://"),ee.set(Y,e)}();var e=window.document.querySelectorAll("link[rel=websocket-endpoint][href]");if(e.length)for(var t=0;t<e.length;t++){var n=(e[t].getAttribute("href")||"").trim();if(""!==n){var r=(e[t].getAttribute("title")||"").trim();""===r&&(r=Y),ee.set(r,n)}}}(),window.BSON&&(V=new BSON,H&&H.addSerializer("bson",we).addDeserializer("bson",Ee)),X=!0,Z.forEach(function(e){return e()}),Z.clear()}function le(t,n,e){var r=!0;return e.forEach(function(e){r=r&&t!==n[e]}),r}function de(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Y;if(oe.has(e)){var t=oe.get(e);return t.readyState===t.OPEN?t:void 0}}function ve(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Y;return te.has(t)||te.set(t,new Map),te.get(t).has(e)||te.get(t).set(e,new Set),te.get(t).get(e)}function pe(e,t){e.forEach(function(e){return e.delete(t)})}function ye(n,r,o){function i(){ce.set(o,ue.CONNECTED),Oe.DEBUG&&console.log("Opened ".concat(r," for ").concat(o)),n.addEventListener("close",t),n.addEventListener("message",a),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Y,t=re.get(e),n=de(e);t&&n&&(t.forEach(function(e){return n.send(e())}),t.clear(),re.delete(e))}(o)}function t(){var e,t;ce.set(o,ue.CLOSED),Oe.DEBUG&&console.log("Closed ".concat(r," for ").concat(o)),n.removeEventListener("open",i),n.removeEventListener("close",a),n.removeEventListener("message",a),e=r,t=o,oe.delete(t),setTimeout(function(){le(ce.get(t),ue,["CONNECTING","RECONNECTING","CONNECTED"])&&(ce.set(t,ue.RECONNECTING),Oe.DEBUG&&console.log("Trying reconnect"),oe.set(t,new WebSocket(e)),ye(oe.get(t),e,t))},3e3)}function a(e){var t=function(t){if(t.id){if(ne.has(t.id)){var e=ne.get(t.id);"error"===t.type?e(t.data,null):e(null,t.data),ne.delete(t.id)}}else te.has(t.type)&&te.get(type).forEach(function(e){return callback(t.data)})};if("string"==typeof e.data)t(ae.get("json")(e.data));else if(e.data instanceof Blob){var n=new FileReader;n.onload=function(){t(new K.Buffer(new Uint8Array(this.result)))},n.readAsArrayBuffer(e.data)}}n.addEventListener("error",function(e){return console.error("Error on ".concat(r," for ").concat(o),e),t()}),n.addEventListener("open",i)}function he(e,t){e=function(e,t){if(e&&(X?ee.set(t,e):Z.add(function(){return ee.set(t,e)})),!e&&!ee.has(t))throw new URIError("No websocket endpoint for ".concat(t));return!e&&ee.has(t)&&(e=ee.get(t)),e}(e,t),le(ce.get(t),ue,["CONNECTING","RECONNECTING","CONNECTED"])&&(ce.set(t,ue.CONNECTING),oe.has(t)||oe.set(t,new WebSocket(e)),ye(oe.get(t),e,t))}function we(e){try{return V.serialize(e)}catch(e){throw new TypeError("Could not convert data to bson for sending")}}function ge(e){try{return JSON.stringify(e)}catch(e){throw new TypeError("Could not convert data to json for sending")}}function be(e){try{return JSON.parse(e)}catch(e){throw new TypeError("Could not convert from json string.")}}function Ee(e){try{return V.deserialize(e)}catch(e){throw new TypeError("Could not convert from json string.")}}var Oe=function(){function e(){return c(this,e),H||(H=this),this.addSerializer("json",ge).addDeserializer("json",be),V&&this.addSerializer("bson",we).addDeserializer("bson",Ee),H}var t,n,r;return t=e,(n=[{key:"connect",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Y;if(!e&&!X)return Z.add(function(){return he(e,t)});he(e,t)}},{key:"drop",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Y;e=t,oe.get(e).close()}},{key:"listen",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Y;return ve(t,n).add(e),function(){return ve(t,n).delete(e)}}},{key:"removeListener",value:function(t,e){if(e&&te.has(e))return pe(te.get(e),t);te.forEach(function(e){return pe(e,t)})}},{key:"request",value:function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Y,u=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"json";return a.method=a.method||"get",new Promise(function(e,t){var o,i,n=Q();ne.set(n,(o=e,i=t,function(e,t){if(e)return i(e);if(400<=(t.status||200)){if(e)return i(e);var n=(t.body||t.statusMessage||"").trim(),r=t.status||400;return i(new fe({message:n,status:r}))}return o(t)}));var r={type:"request",id:n,data:a};!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Y,n=de(t);if(n)return n.send(e());re.has(t)||re.set(t,new Set),re.get(t).add(e)}(function(){if(ie.has(u))return ie.get(u)(r);throw new TypeError("No parser for type ".concat(u))},c)})}},{key:"requestJson",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Y;return this.request(e,t,"json")}},{key:"requestBson",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Y;return this.request(e,t,"bson")}},{key:"ready",value:function(){return!!de(0<arguments.length&&void 0!==arguments[0]?arguments[0]:Y)}},{key:"addEndpoint",value:function(e,t){return ee.set(e,t),this}},{key:"removeEndpoint",value:function(e){return ee.delete(e),this}},{key:"addSerializer",value:function(e,t){return ie.set(e,t),this}},{key:"removeSerializer",value:function(e){return ie.delete(e),this}},{key:"addDeserializer",value:function(e,t){return ae.set(e,t),this}},{key:"removeDeserializer",value:function(e){return ae.delete(e),this}},{key:"defaultSocketId",get:function(){return Y}},{key:Symbol.toStringTag,get:function(){return"WebSocketService"}}])&&o(t.prototype,n),r&&o(t,r),e}();Oe.DEBUG=!1,function(){var e=window,t=e.jQuery,n=void 0===t?window.$&&window.$.jQuery?window.$:void 0:t,r=e.angular,o=e.bolt,i=e.document;function a(){document.removeEventListener("DOMContentLoaded",a),window.removeEventListener("load",a),se()}n&&(window.jQuery.websocket=new Oe),r&&r.module("websocket-express",[]).factory("$websocket",function(){return new Oe}),o&&(o.WebSocketService=Oe,o.MODE&&(o.MODE.has("DEVELOPMENT")||o.MODE.has("DEBUG"))&&(o.WebSocketService.DEBUG=!0)),o&&n&&r&&(window.WebSocketService=Oe),"complete"===i.readyState||"loading"!==i.readyState&&!i.documentElement.doScroll?window.setTimeout(se):(document.addEventListener("DOMContentLoaded",a),window.addEventListener("load",a))}()});
//# sourceMappingURL=websocket-express.production.min.js.map
