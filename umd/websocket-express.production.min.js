!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t,n){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function u(e){var t="function"==typeof Map?new Map:void 0;return(u=function(e){if(null===e)return null;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return i(e,arguments,r(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)})(e)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var a="object"==("undefined"==typeof global?"undefined":e(global))&&global&&global.Object===Object&&global,f="object"==("undefined"==typeof self?"undefined":e(self))&&self&&self.Object===Object&&self,l=a||f||Function("return this")(),s=l.Symbol,d=Object.prototype,v=d.hasOwnProperty,p=d.toString,y=s?s.toStringTag:void 0;var h=Object.prototype.toString;var w="[object Null]",b="[object Undefined]",g=s?s.toStringTag:void 0;function E(e){return null==e?void 0===e?b:w:g&&g in Object(e)?function(e){var t=v.call(e,y),n=e[y];try{e[y]=void 0}catch(e){}var r=p.call(e);return t?e[y]=n:delete e[y],r}(e):function(e){return h.call(e)}(e)}function m(t){return null!=t&&"object"==e(t)}var O="[object Arguments]";function S(e){return m(e)&&E(e)==O}var j=Object.prototype,N=j.hasOwnProperty,C=j.propertyIsEnumerable;S(function(){return arguments}()),s&&s.isConcatSpreadable;function k(t){var n=e(t);return null!=t&&("object"==n||"function"==n)}var T="[object AsyncFunction]",D="[object Function]",M="[object GeneratorFunction]",L="[object Proxy]";var G,P=l["__core-js_shared__"],R=(G=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"";var _=Function.prototype.toString;var z=/^\[object .+?Constructor\]$/,A=Function.prototype,I=Object.prototype,B=A.toString,U=I.hasOwnProperty,$=RegExp("^"+B.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function q(e){return!(!k(e)||(t=e,R&&R in t))&&(function(e){if(!k(e))return!1;var t=E(e);return t==D||t==M||t==T||t==L}(e)?$:z).test(function(e){if(null!=e){try{return _.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function x(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return q(n)?n:void 0}x(Object,"create"),x(l,"Map");var F=x(l,"Set");F&&(W=new F([,-0]),J=-1,Q=Array(W.size),W.forEach(function(e){Q[++J]=e}),Q)[1];var W,J,Q,V="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");function H(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;return new Array(e).fill(0).map(function(){return V[function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*e)+t}(V.length-1)]}).join("")}var K,X,Z=window.buffer,Y=!1,ee=new Set,te="main",ne=new Map,re=new Map,oe=new Map,ie=new Map,ue=new Map,ce=new Map,ae=new Map,fe=new Map,le=Object.freeze({CONNECTING:1,RECONNECTING:2,CLOSED:3,CONNECTED:4}),se=function(e){function n(e){var o,i;t(this,n);for(var u=arguments.length,a=new Array(u>1?u-1:0),f=1;f<u;f++)a[f-1]=arguments[f];return(i=c(this,(o=r(n)).call.apply(o,[this,e.message].concat(a)))).status=e.status,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,u(Error)),n}();function de(){!function(){!function(){var e,t=[window.location.origin,window.document.querySelector("base[href]")],n=t[0],r=t[1];if(r){var o=(r.getAttribute("href")||"").trim().replace(n,"");""!==o&&(e="".concat(n).concat(o))}else e="".concat(n,"/");e=e.replace("https://","wss://").replace("http://","ws://"),ne.set(te,e)}();var e=window.document.querySelectorAll("link[rel=websocket-endpoint][href]");if(e.length)for(var t=0;t<e.length;t++){var n=(e[t].getAttribute("href")||"").trim();if(""!==n){var r=(e[t].getAttribute("title")||"").trim();""===r&&(r=te),ne.set(r,n)}}}(),window.BSON&&X&&X.addSerializer("bson",ge).addDeserializer("bson",Oe),Y=!0,ee.forEach(function(e){return e()}),ee.clear()}function ve(e,t,n){var r=!0;return n.forEach(function(n){r=r&&e!==t[n]}),r}function pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te;if(ue.has(e)){var t=ue.get(e);return t.readyState===t.OPEN?t:void 0}}function ye(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te;return re.has(t)||re.set(t,new Map),re.get(t).has(e)||re.get(t).set(e,new Set),re.get(t).get(e)}function he(e,t){e.forEach(function(e){return e.delete(t)})}function we(e,t,n){function r(){fe.set(n,le.CONNECTED),Se.DEBUG&&console.log("Opened ".concat(t," for ").concat(n)),e.addEventListener("close",o),e.addEventListener("message",i),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=ie.get(e),n=pe(e);t&&n&&(t.forEach(function(e){return n.send(e())}),t.clear(),ie.delete(e))}(n)}function o(){fe.set(n,le.CLOSED),Se.DEBUG&&console.log("Closed ".concat(t," for ").concat(n)),e.removeEventListener("open",r),e.removeEventListener("close",i),e.removeEventListener("message",i),function(e,t){ue.delete(t),setTimeout(function(){ve(fe.get(t),le,["CONNECTING","RECONNECTING","CONNECTED"])&&(fe.set(t,le.RECONNECTING),Se.DEBUG&&console.log("Trying reconnect"),ue.set(t,new WebSocket(e)),we(ue.get(t),e,t))},3e3)}(t,n)}function i(e){var t=function(e){if(e.id){if(oe.has(e.id)){var t=oe.get(e.id);"error"===e.type?t(e.data,null):t(null,e.data),oe.delete(e.id)}}else re.has(e.type)&&re.get(type).forEach(function(t){return callback(e.data)})};if("string"==typeof e.data)t(ae.get("json")(e.data));else if(e.data instanceof Blob){var n=new FileReader;n.onload=function(){t(new Z.Buffer(new Uint8Array(this.result)))},n.readAsArrayBuffer(e.data)}}e.addEventListener("error",function(e){return console.error("Error on ".concat(t," for ").concat(n),e),o()}),e.addEventListener("open",r)}function be(e,t){e=function(e,t){if(e&&(Y?ne.set(t,e):ee.add(function(){return ne.set(t,e)})),!e&&!ne.has(t))throw new URIError("No websocket endpoint for ".concat(t));return!e&&ne.has(t)&&(e=ne.get(t)),e}(e,t),ve(fe.get(t),le,["CONNECTING","RECONNECTING","CONNECTED"])&&(fe.set(t,le.CONNECTING),ue.has(t)||ue.set(t,new WebSocket(e)),we(ue.get(t),e,t))}function ge(e){try{return K.serialize(e)}catch(e){throw new TypeError("Could not convert data to bson for sending")}}function Ee(e){try{return JSON.stringify(e)}catch(e){throw new TypeError("Could not convert data to json for sending")}}function me(e){try{return JSON.parse(e)}catch(e){throw new TypeError("Could not convert from json string.")}}function Oe(e){try{return K.deserialize(e)}catch(e){throw new TypeError("Could not convert from json string.")}}var Se=function(){function e(){return t(this,e),X||(X=this),this.addSerializer("json",Ee).addDeserializer("json",me),X}var r,o,i;return r=e,(o=[{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te;if(!e&&!Y)return ee.add(function(){return be(e,t)});be(e,t)}},{key:"drop",value:function(){!function(e){ue.get(e).close()}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:te)}},{key:"listen",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te;return ye(t,n).add(e),function(){return ye(t,n).delete(e)}}},{key:"removeListener",value:function(e,t){if(t&&re.has(t))return he(re.get(t),e);re.forEach(function(t){return he(t,e)})}},{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"json";return e.method=e.method||"get",new Promise(function(r,o){var i=H();oe.set(i,function(e,t){return function(n,r){if(n)return t(n);if((r.status||200)>=400){if(n)return t(n);var o=(r.body||r.statusMessage||"").trim(),i=r.status||400;return t(new se({message:o,status:i}))}return e(r)}}(r,o));var u={type:"request",id:i,data:e};!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te,n=pe(t);if(n)return n.send(e());ie.has(t)||ie.set(t,new Set),ie.get(t).add(e)}(function(){if(ce.has(n))return ce.get(n)(u);throw new TypeError("No parser for type ".concat(n))},t)})}},{key:"requestJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te;return this.request(e,t,"json")}},{key:"requestBson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te;return this.request(e,t,"bson")}},{key:"ready",value:function(){return!!pe(arguments.length>0&&void 0!==arguments[0]?arguments[0]:te)}},{key:"addEndpoint",value:function(e,t){return ne.set(e,t),this}},{key:"removeEndpoint",value:function(e){return ne.delete(e),this}},{key:"addSerializer",value:function(e,t){return ce.set(e,t),this}},{key:"removeSerializer",value:function(e){return ce.delete(e),this}},{key:"addDeserializer",value:function(e,t){return ae.set(e,t),this}},{key:"removeDeserializer",value:function(e){return ae.delete(e),this}},{key:"defaultSocketId",get:function(){return te}},{key:Symbol.toStringTag,get:function(){return"WebSocketService"}}])&&n(r.prototype,o),i&&n(r,i),e}();Se.DEBUG=!1,function(){var e=window,t=e.jQuery,n=void 0===t?window.$&&window.$.jQuery?window.$:void 0:t,r=e.angular,o=e.bolt,i=e.document;function u(){document.removeEventListener("DOMContentLoaded",u),window.removeEventListener("load",u),de()}n&&(window.jQuery.websocket=new Se),r&&r.module("websocket-express",[]).factory("$websocket",function(){return new Se}),o&&(o.WebSocketService=Se,o.MODE&&(o.MODE.has("DEVELOPMENT")||o.MODE.has("DEBUG"))&&(o.WebSocketService.DEBUG=!0)),o&&n&&r&&(window.WebSocketService=Se),"complete"===i.readyState||"loading"!==i.readyState&&!i.documentElement.doScroll?window.setTimeout(de):(document.addEventListener("DOMContentLoaded",u),window.addEventListener("load",u))}()});
//# sourceMappingURL=websocket-express.production.min.js.map
